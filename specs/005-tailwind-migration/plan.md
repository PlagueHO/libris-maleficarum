# Implementation Plan: Tailwind CSS Migration with Shadcn/UI

**Branch**: `005-tailwind-migration` | **Date**: 2026-01-21 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/005-tailwind-migration/spec.md`

## Summary

Complete migration from CSS Modules to Tailwind CSS utility classes across all application components (<10 total). All styling must use Tailwind CSS v4 with Shadcn/UI components, maintaining existing visual appearance while removing all `*.module.css` files. Migration uses big-bang approach (all components at once) with screenshot comparison testing to verify zero visual regression.

## Technical Context

**Language/Version**: JavaScript (ES2022), React 19.2.0, TypeScript 5.9.3  
**Primary Dependencies**:

- Tailwind CSS v4.1.18 (already installed with @tailwindcss/vite plugin)
- Shadcn/UI components (17 components already installed in src/components/ui/)
- Class Variance Authority (CVA) v0.7.1 for variant management
- Radix UI primitives (context-menu, dialog, popover, scroll-area, select, separator, slot, tooltip)
- Lucide React v0.562.0 for icons

**Storage**: Redux Toolkit v2.11.2 for state management (no data storage migration needed)  
**Testing**:

- Vitest v4.0.17 for unit/component tests
- @testing-library/react v16.3.1 for component testing
- jest-axe v10.0.0 for accessibility testing
- Playwright (needs installation) for screenshot comparison tests

**Target Platform**: Web (Chrome, Firefox, Safari, Edge - modern evergreen browsers)  
**Project Type**: Single-page React application (SPA) with Vite v7.3.1 build tool  
**Performance Goals**:

- First Contentful Paint (FCP) < 1.5s
- Largest Contentful Paint (LCP) < 2.5s
- 30%+ reduction in CSS bundle size vs CSS Modules baseline

**Constraints**:

- Zero visual regression (pixel-perfect match to current appearance)
- 100% accessibility compliance (WCAG 2.2 Level AA) maintained
- All existing tests must pass with minimal modifications
- Hot reload must continue working during development

**Scale/Scope**:

- 7 CSS Module files to remove
- 6 component directories to migrate (ChatPanel, MainPanel, shared, TopToolbar, WorldSidebar, ui)
- ~10-15 individual components total
- 17 Shadcn/UI components already installed and ready to use

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| **III. Test-Driven Development** | ✅ PASS | Existing jest-axe accessibility tests maintained. Screenshot comparison tests added for visual regression detection. All component tests updated to remove CSS Module imports. |
| **IV. Framework & Technology Standards** | ✅ PASS | React 19.2.0 ✓, TypeScript 5.9.3 ✓, Vitest ✓, Redux Toolkit ✓. Migration adds Tailwind CSS v4 and Shadcn/UI (both align with modern React ecosystem). |
| **Frontend Standards** | ✅ PASS | Functional components with hooks ✓, ARIA roles maintained ✓, component tests maintained ✓. CSS Modules being REMOVED (replaced with Tailwind utility classes as per feature requirement). |
| **VII. Semantic Versioning** | ✅ PASS | This is a MAJOR version change due to complete styling system replacement (breaking change for any external consumers of component styling APIs). |

**Gate Decision**: ✅ **PROCEED** - All constitutional requirements met. CSS Module removal is intentional (feature requirement), not a violation. All other standards maintained or improved.

## Project Structure

### Documentation (this feature)

```text
specs/005-tailwind-migration/
├── plan.md              # This file
├── research.md          # Phase 0: Tailwind patterns, CVA usage, screenshot testing setup
├── data-model.md        # Phase 1: Component inventory with styling complexity
├── quickstart.md        # Phase 1: Developer guide for Tailwind + Shadcn/UI patterns
├── contracts/           # N/A (no API contracts for styling migration)
└── tasks.md             # Phase 2: Generated by /speckit.tasks command
```

### Source Code (repository root)

```text
libris-maleficarum-app/
├── src/
│   ├── components/
│   │   ├── ChatPanel/           # To migrate (currently uses CSS Modules)
│   │   ├── MainPanel/           # To migrate (2 CSS Modules: WorldDetailForm, DeleteConfirmationModal)
│   │   ├── shared/              # To migrate (check for CSS Modules)
│   │   ├── TopToolbar/          # To migrate (check for CSS Modules)
│   │   ├── WorldSidebar/        # To migrate (5 CSS Modules: EmptyState, WorldSidebar, WorldSelector, EntityTreeNode, EntityTree)
│   │   └── ui/                  # Already using Tailwind (17 Shadcn/UI components)
│   ├── App.tsx                  # May have inline styles to migrate
│   ├── App.css                  # Check for global styles (may keep for Tailwind layers)
│   ├── index.css                # Tailwind directives (@import "tailwindcss")
│   └── __tests__/               # Update test files to remove CSS Module imports
├── components.json              # Shadcn/UI config (already configured)
├── package.json                 # Add Playwright for screenshot tests
├── playwright.config.ts         # New: Playwright configuration
├── vitest.config.ts             # Existing: may need updates for test helpers
└── tests/
    └── visual/                  # New: Screenshot baseline and comparison tests
```

**Structure Decision**: Single web application structure. Migration touches all component directories except `ui/` (already Tailwind-based). No backend changes needed—this is purely frontend styling migration.

## Complexity Tracking

> **No constitutional violations** - This section intentionally left empty as all gates passed.

## Phase 0: Research & Discovery

**Objective**: Resolve all technical unknowns and establish migration patterns.

### Research Tasks

1. **Tailwind CSS v4 Best Practices**
   - Document Tailwind v4 configuration patterns (CSS-based config vs tailwind.config.js)
   - Identify utilities for common patterns (flexbox, grid, spacing, colors)
   - Document responsive design patterns (sm:, md:, lg:, xl:, 2xl: breakpoints)
   - Research animation and transition utilities
   - Document hover/focus/active state patterns

1. **Class Variance Authority (CVA) Patterns**
   - Document CVA usage for button variants (size, color, disabled states)
   - Research compound variants (combinations like size + color)
   - Document type-safe variant prop patterns with TypeScript
   - Study Shadcn/UI source code for CVA best practices

1. **Screenshot Testing Setup**
   - Evaluate Playwright vs other visual regression tools
   - Document screenshot baseline capture process
   - Research CI/CD integration for automated visual regression detection
   - Document workflow for updating baselines when intentional changes occur
   - Identify optimal viewport sizes for screenshot capture (mobile, tablet, desktop)

1. **CSS Module to Tailwind Mapping**
   - Analyze existing CSS Module files for common patterns
   - Create mapping guide: flexbox layouts → flex/grid utilities
   - Create mapping guide: spacing patterns → Tailwind spacing scale
   - Create mapping guide: color values → Tailwind color palette
   - Document handling of complex selectors (pseudo-elements, child combinators)

1. **Test Migration Strategy**
   - Document pattern for removing CSS Module imports from tests
   - Research replacing class name assertions with data-testid or ARIA queries
   - Document maintaining accessibility test coverage during migration
   - Identify any test utilities that need updating

**Deliverable**: `research.md` with all findings, code examples, and decision rationale.

---

## Phase 1: Design & Contracts

**Objective**: Design component-by-component migration approach and document patterns.

### Data Model (Component Inventory)

**File**: `data-model.md`

Document each component with:

- Component name and file path
- Current CSS Module file(s) used
- Styling complexity rating (Simple/Medium/Complex)
- Dependencies on other components
- Migration priority (based on component tree—leaf components first)
- Estimated effort (hours)

Example structure:

```markdown
### Component: WorldDetailForm
- **Path**: `src/components/MainPanel/WorldDetailForm.tsx`
- **CSS Module**: `WorldDetailForm.module.css`
- **Complexity**: Medium (form layout, input styling, validation states)
- **Dependencies**: Uses Shadcn/UI Input, Button, Select components
- **Priority**: P2 (depends on shared components being migrated first)
- **Effort**: 2-3 hours

**Current Styling Patterns**:
- Form layout with grid
- Input field spacing and sizing
- Error state styling
- Submit button placement

**Tailwind Approach**:
- Use `<FormLayout>` from Shadcn/UI
- Grid utilities: `grid grid-cols-2 gap-4`
- Shadcn/UI `<Input>` with built-in error states
- Button placement: `flex justify-end gap-2`
```

### Quickstart Guide

**File**: `quickstart.md`

Developer guide covering:

1. **Setup**
   - Verify Tailwind CSS v4 is configured
   - Confirm Shadcn/UI components available in `src/components/ui/`
   - Install Playwright for screenshot testing

1. **Migration Pattern**
   - Step-by-step: Remove CSS Module import → Apply Tailwind classes
   - Using CVA for component variants
   - Leveraging Shadcn/UI components
   - Running screenshot tests to verify visual parity

1. **Common Patterns**

   ```tsx
   // Before (CSS Modules)
   import styles from './Component.module.css';
   <div className={styles.container}>
   
   // After (Tailwind)
   <div className="flex flex-col gap-4 p-6 bg-background">
   ```

1. **Testing**
   - Update tests to remove CSS Module imports
   - Use `data-testid` or ARIA queries instead of class names
   - Run `pnpm test` to verify component tests pass
   - Run Playwright visual tests to verify appearance

1. **Troubleshooting**
   - Common Tailwind class conflicts
   - Debugging responsive breakpoints
   - Handling complex animations
   - When to use @apply directive (sparingly)

**Deliverable**: `quickstart.md` with code examples and best practices.

### Contracts

**N/A** - No API contracts needed for styling migration. Skip contracts directory creation.

---

## Phase 2: Task Breakdown

**Objective**: NOT PERFORMED BY THIS COMMAND. Run `/speckit.tasks` after Phase 1 completion.

The `/speckit.tasks` command will generate granular implementation tasks in `tasks.md` based on the component inventory in `data-model.md`.

---

## Post-Phase 1 Constitution Re-Check

*Run after Phase 1 design is complete*

| Principle | Status | Notes |
|-----------|--------|-------|
| **III. Test-Driven Development** | ⏳ PENDING | Verify screenshot baseline tests created before migration starts. |
| **Frontend Standards** | ⏳ PENDING | Verify all components maintain ARIA attributes and accessibility. |
| **IV. Framework Standards** | ⏳ PENDING | Verify CVA used for all component variants. |

**Expected Outcome**: All gates remain PASS after design phase completion.

---

## Dependencies & Prerequisites

**Before Starting**:

1. ✅ Tailwind CSS v4.1.18 already installed
1. ✅ Shadcn/UI configured (components.json exists)
1. ✅ 17 Shadcn/UI components already available
1. ⏳ Install Playwright for visual regression testing
1. ⏳ Capture baseline screenshots of all components (pre-migration state)

**External Dependencies**: None (all tools and libraries already in package.json or will be added)

**Risks**:

- Visual regressions not caught by screenshot tests (mitigated by manual review)
- Complex CSS patterns difficult to replicate with Tailwind (mitigated by @apply directive as escape hatch)
- Test fragility from removing CSS Module class references (mitigated by using data-testid attributes)

---

## Success Criteria Mapping

From `spec.md` → Implementation validation:

| Success Criterion | Validation Method |
|-------------------|-------------------|
| SC-001: Zero CSS Module files | `git ls-files '*.module.css'` returns empty |
| SC-002: 100% accessibility tests pass | `pnpm test -- --grep "accessibility"` passes |
| SC-003: 30%+ CSS bundle reduction | Compare `dist/assets/*.css` size before/after |
| SC-004: All tests pass | `pnpm test` exits 0 |
| SC-005: Screenshot tests pass | Playwright visual regression tests show 0 differences |
| SC-006: Build time maintained | Compare `pnpm build` duration before/after |
| SC-007: 100% Shadcn/UI usage | Manual code review confirms all primitives use Shadcn/UI |
| SC-008: Development velocity | Measure time to create new component after migration |
| SC-009: Visual consistency | Playwright screenshots match pixel-perfect |
| SC-010: Lighthouse a11y score 100 | Run Lighthouse audit on deployed app |
| SC-011: Faster code review | Subjective measurement post-migration |

---

## Timeline Estimate

Based on 7 CSS Module files and ~10-15 components:

- **Phase 0 (Research)**: 4-6 hours
- **Phase 1 (Design/Documentation)**: 3-4 hours
- **Phase 2 (Implementation)**: 16-20 hours (big-bang approach, all components)
- **Testing & Validation**: 4-6 hours
- **Total**: **27-36 hours** (~1 week of focused work)

**Critical Path**:

1. Phase 0 research (CVA patterns, screenshot setup)
1. Capture baseline screenshots
1. Migrate leaf components (buttons, inputs) first
1. Migrate composite components (forms, panels)
1. Run screenshot comparison tests
1. Fix any visual regressions
1. Update all component tests
1. Validate success criteria
